# zigbee网关-mqtt通信数据格式
## 1、网关->mqtt服务器
>完整数据包：{"msg":"dev2,...","flow":201}
>>- 包中flow表示数据流向，1表示服务器，02表示设备网关，网关可以有多个，可以为02，03，04...。<br>
>>- 包中msg表示对服务器回传的信息
>>>      1、当为dev2,switch1,0时，表示设备dev2中的switch1开关当前状态为关（0表示关）；

## 2、mqtt服务器->网关
>完整数据包：{"msg":"dev2,...","flow":102}
>>- 包中flow表示数据流向，1表示安卓终端，02表示设备网关，网关可以有多个，可以为02，03，04...。<br>
>>- 包中msg表示对设备下发的指令
>>>      1、当为dev2,switch1,0时，表示命令设备dev2中的switch1开关断开（0表示）；
>>>      2、当为dev2,switch1,ck时，表示查询设备dev2中的switch1开关状态；
>>>      3、完成指令2后，设备应返回给mqtt固定数据包，数据包即包含对应设备对应开关当前状态，数据包格式见章节1。
>>>      4、当完成指令1后，设备同样会查询指令1中命令的开关状态并已指令3的方式返回给mqtt服务器；

## 3、相关指令
>- 指令：{"flow":102,"msg":"devstatus,ck"}
>- 作用：查询协调器下所有设备在线状态，如在线，则查询该设备所有开关状态；
>- 通信原理：服务器向协调器发送指令后，协调器读取内存中所有设备在线状态，如在线则协调器向终端发送指令【status,ck】，终端则根据该指令返回所有开关状态【switch1,0,switch2,1】给协调器，协调器再转发至服务器；
>- 返回：{"msg":"devstatus,0010","flow":201}，{"msg":"dev2,switch1,0,switch2,1","flow":201}
>- 返回包含义：【devstatus,0010】表示四台预设设备中第三台在线，其余不在线；【dev2,switch1,0,switch2,1】表示设备dev2的开关1状态为关，开关2状态为开；

>- 指令：{"flow":102,"msg":"0"}
>- 作用：检查协调器联网状态；
>- 通信原理：无；
>- 返回：{"flow":201,"msg":"0"}
>- 返回包含义：如返回上述返回值，则确认协调器在线，如超时无返回值，认为协调器离线；


